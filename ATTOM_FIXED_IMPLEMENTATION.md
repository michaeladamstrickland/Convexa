# ATTOM API Integration - Fixed Implementation

This document provides instructions on how to use the fixed ATTOM API integration for FlipTracker.

## Overview of Changes

We've made several important changes to fix the issues with the ATTOM API integration:

1. **Fixed API Field Mapping**: The original code was looking for fields in the wrong locations or with incorrect names. We've updated the field mappings to match the actual ATTOM API response structure.

2. **Improved Error Handling**: Added better error handling and fallbacks for missing data.

3. **Enhanced Frontend Component**: Updated the PropertyDetailEnhanced component to safely handle missing values and provide fallbacks.

4. **Multiple Endpoint Integration**: Now pulling data from multiple ATTOM API endpoints to get the most complete property information possible.

## How to Use the Fixed Implementation

### Step 1: Start the Fixed ATTOM API Server

Windows:
```
run-attom-server-fixed.bat
```

Linux/Mac:
```
./run-attom-server-fixed.sh
```

The server will run on port 5002 and provide the necessary API endpoints for the frontend.

### Step 2: Update the Frontend Component

Replace the current PropertyDetailEnhanced.jsx with PropertyDetailEnhanced-fixed.jsx:

```
cp frontend/PropertyDetailEnhanced-fixed.jsx frontend/PropertyDetailEnhanced.jsx
```

### Step 3: Update the Backend Routes

Replace the current attom-routes.js with attom-routes-fixed.js:

```
cp backend/attom-routes-fixed.js backend/attom-routes.js
```

### Step 4: Test the Implementation

1. Start the ATTOM API server (see Step 1)
2. Start the frontend application
3. Search for a property and verify that the data is displayed correctly

## API Endpoints

The following endpoints are available:

- `GET /api/attom/status`: Check the status of the ATTOM API server
- `GET /api/attom/property/address`: Search for properties by address
- `GET /api/attom/property/zip`: Search for properties by ZIP code
- `GET /api/attom/property/:attomId`: Get basic property details
- `GET /api/attom/property/:attomId/detail`: Get comprehensive property details (recommended)

## Troubleshooting

If you still see "N/A" values in the UI:

1. Check the browser console for detailed logging of the property data
2. Look at the _debug object in the API response to see the raw API data
3. Use the "Debug API Data" button on the property detail page to see the raw API responses

## ATTOM API Field Reference

Based on our testing, here are the key fields and their correct paths in the ATTOM API response:

### Basic Property Info
- Property Type: `property.summary.proptype` or `property.summary.propertyType`
- Year Built: `property.summary.yearbuilt` or `property.summary.yearBuilt`
- Square Feet: `property.building.size.universalsize` or `property.building.size.livingsize`
- Lot Size: `property.lot.lotsize1` or `property.lot.lotSize1`
- Bedrooms: `property.building.rooms.beds`
- Bathrooms: `property.building.rooms.bathsFull`

### Sale Information
- Last Sale Date: `property.sale.saleTransDate` or `property.sale.saleSearchDate`
- Last Sale Price: `property.sale.amount.saleAmt` or `property.sale.amount.saleamt`

### Tax Information
- Assessed Value: `property.assessment.assessed.assdttlvalue` or `property.assessment.assessed.assdTtlValue`
- Market Value: `property.assessment.market.mktttlvalue` or `property.assessment.market.mktTtlValue`
- Tax Year: `property.assessment.tax.taxyear` or `property.assessment.tax.taxYear`
- Tax Amount: `property.assessment.tax.taxamt` or `property.assessment.tax.taxAmt`

For a complete reference, see the API structure in the property_detail_{id}.json and property_expandedprofile_{id}.json files generated by the test-attom-api-improved.js script.
