groups:
- name: convexa.alerts
  rules:
  - alert: ConvexaHighErrorRateWarn
    expr: convexa_error_rate_5m > 0.05
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "Convexa error rate is high (instance {{ $labels.instance }})"
      description: "Convexa error rate is {{ $value | humanizePercentage }} for 5 minutes."
  - alert: ConvexaCriticalErrorRatePage
    expr: convexa_error_rate_5m > 0.10
    for: 10m
    labels:
      severity: critical
    annotations:
      summary: "Convexa critical error rate (instance {{ $labels.instance }})"
      description: "Convexa error rate is {{ $value | humanizePercentage }} for 10 minutes. Paging required."
  - alert: ConvexaDLQDepthHigh
    expr: convexa_dlq_depth > 10
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "Convexa DLQ depth is high (instance {{ $labels.instance }})"
      description: "Convexa DLQ depth is {{ $value }} for 5 minutes."
  - alert: ConvexaResumeP95High
    expr: histogram_quantile(0.95, sum(rate(convexa_resume_duration_seconds_bucket[5m])) by (le)) > 300
    for: 10m
    labels:
      severity: warning
    annotations:
      summary: "Convexa resume p95 duration is high (instance {{ $labels.instance }})"
      description: "Convexa resume p95 duration is {{ $value }}s for 10 minutes."
  - alert: ConvexaQuotaFractionWarn
    expr: convexa_quota_fraction > 0.8
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "Convexa quota fraction is high (instance {{ $labels.instance }})"
      description: "Convexa quota fraction is {{ $value | humanizePercentage }} for 5 minutes."
  - alert: ConvexaQuotaFractionPage
    expr: convexa_quota_fraction > 0.95
    for: 5m
    labels:
      severity: critical
    annotations:
      summary: "Convexa critical quota fraction (instance {{ $labels.instance }})"
      description: "Convexa quota fraction is {{ $value | humanizePercentage }} for 5 minutes. Paging required."
